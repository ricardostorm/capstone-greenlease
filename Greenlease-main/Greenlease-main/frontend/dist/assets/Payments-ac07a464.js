import{r as i,k as v,n as L,j as e,ac as x,a3 as C,Q as S,D as t,F as T,R as w,x as I,ad as A,ae as B,af as H,ag as N,a6 as E,ah as R,ai as j,aj as k}from"./index-833ef727.js";import{A as s}from"./react-apexcharts.min-3c450f43.js";const D=i.forwardRef(({bsPrefix:n,className:a,striped:l,bordered:y,borderless:d,hover:h,size:m,variant:u,responsive:f,...P},r)=>{const c=v(n,"table"),p=L(a,c,u&&`${c}-${u}`,m&&`${c}-${m}`,l&&`${c}-${typeof l=="string"?`striped-${l}`:"striped"}`,y&&`${c}-bordered`,d&&`${c}-borderless`,h&&`${c}-hover`),g=e("table",{...P,className:p,ref:r});if(f){let _=`${c}-responsive`;return typeof f=="string"&&(_=`${_}-${f}`),e("div",{className:_,children:g})}return g});function F(n){i.useEffect(()=>{const a=document.querySelector("body"),l=document.createElement("script");return l.setAttribute("src",n),a.appendChild(l),()=>{a.removeChild(l)}},[n])}function K({pendingPayments:n,totalPending:a}){const l=async d=>{console.log(d);for(let h in n){let m=new Date(n[h].date_due)>=new Date?n[h].contract_price:n[h].contract_price+n[h].late_fee;await x(n[h].invoice_id,m)}window.location.reload(!1)},y=()=>{window.ATHM_Checkout={env:"sandbox",publicToken:"sandboxtoken01875617264",timeout:600,theme:"btn",lang:"en",total:a,tax:0,subtotal:a,metadata1:"metadata1 test",metadata2:"metadata2 test",items:[{name:`${n[0].contract_name} Monthly Payment`,description:"This is a description.",quantity:"1",price:a,tax:"0",metadata:"metadata test"}],onCompletedPayment:function(d){l(d)},onCancelledPayment:function(d){l(d)},onExpiredPayment:function(d){console.log(d)}},F("https://www.athmovil.com/api/js/v3/athmovilV3.js")};return!n||!a?e("div",{className:"no-pay-btn"}):(y(),e("div",{id:"ATHMovil_Checkout_Button"}))}function Q(){const[n,a]=C("user",null);return e("div",{className:"payments",children:n.type==="landlord"?e(M,{user:n}):e(O,{user:n})})}function M({user:n}){const[a,l]=i.useState(null),y=async()=>{l(await B(n.landlord_id))},[d,h]=i.useState(null),m=async()=>{h(await H(n.landlord_id))},[u,f]=i.useState(null),P=async()=>{f(await N(n.landlord_id))},[r,c]=i.useState(null),p=async()=>{c(await E(n.landlord_id))},[g,_]=i.useState(!1);return i.useEffect(()=>{m(),y(),P(),p()},[]),!a||!u?e(S,{}):t(T,{children:[t(w,{children:["Total Revenue",t("div",{className:"total",children:["$",d||0]}),e(I,{className:"invoice-btn",onClick:()=>_(!0),children:"Create Invoice +"})]}),t(s,{flush:!0,alwaysOpen:!0,children:[t(s.Item,{eventKey:"0",children:[t(s.Header,{children:["Pending Payments (",a.length,")"]}),e(s.Body,{children:e(w,{xs:"auto",children:t(D,{striped:!0,bordered:!0,hover:!0,children:[e("thead",{children:t("tr",{children:[e("th",{children:"Contract"}),e("th",{children:"Issued"}),e("th",{children:"Due"}),e("th",{children:"Late Fee"}),e("th",{children:"Amount"})]})}),e("tbody",{children:a.map((o,b)=>t("tr",{children:[e("td",{children:o.contract_name}),e("td",{children:new Date(o.date_issued).toLocaleDateString()}),e("td",{children:new Date(o.date_due).toLocaleDateString()}),t("td",{children:["$",o.late_fee]}),t("td",{children:["$",o.contract_price]})]},b))})]})})})]}),t(s.Item,{eventKey:"1",children:[t(s.Header,{children:["Payment History (",u.length,")"]}),e(s.Body,{children:e(w,{xs:"auto",children:t(D,{striped:!0,bordered:!0,hover:!0,children:[e("thead",{children:t("tr",{children:[e("th",{children:"Contract"}),e("th",{children:"Issued"}),e("th",{children:"Paid"}),e("th",{children:"Late Fee"}),e("th",{children:"Total"})]})}),e("tbody",{children:u.map((o,b)=>{var $=new Date(o.date_paid)>new Date(o.date_due);return t("tr",{children:[e("td",{children:o.contract_name}),e("td",{children:new Date(o.date_issued).toLocaleDateString()}),e("td",{style:$?{color:"red"}:{color:"green"},children:new Date(o.date_paid).toLocaleDateString()}),t("td",{children:["$",$?o.late_fee:0]}),t("td",{children:["$",o.total_paid]})]},b)})})]})})})]})]}),e(A,{open:g,setOpen:_,user:n,contracts:r})]})}function O({user:n}){const[a,l]=i.useState(null),y=async()=>{l(await R(n.tenant_id))},[d,h]=i.useState(0),m=async()=>{h(await j(n.tenant_id))},[u,f]=i.useState(null),P=async()=>{f(await k(n.tenant_id))};return i.useEffect(()=>{m(),y(),P()},[]),!a||!u?e(S,{}):t(T,{children:[t(w,{children:["Total Pending:",t("div",{className:"total",children:["$",d||0]}),a.length==0?null:e(K,{pendingPayments:a,totalPending:d})]}),t(s,{flush:!0,alwaysOpen:!0,children:[t(s.Item,{eventKey:"0",children:[t(s.Header,{children:["Pending Payments (",a.length,")"]}),e(s.Body,{children:e(w,{xs:"auto",children:t(D,{striped:!0,bordered:!0,hover:!0,children:[e("thead",{children:t("tr",{children:[e("th",{children:"Contract"}),e("th",{children:"Issued"}),e("th",{children:"Due"}),e("th",{children:"Late Fee"}),e("th",{children:"Amount"})]})}),e("tbody",{children:a.map((r,c)=>t("tr",{children:[e("td",{children:r.contract_name}),e("td",{children:new Date(r.date_issued).toLocaleDateString()}),e("td",{children:new Date(r.date_due).toLocaleDateString()}),t("td",{children:["$",r.late_fee]}),t("td",{children:["$",r.contract_price]})]},c))})]})})})]}),t(s.Item,{eventKey:"1",children:[t(s.Header,{children:["Payment History (",u.length,")"]}),e(s.Body,{children:e(w,{xs:"auto",children:t(D,{striped:!0,bordered:!0,hover:!0,children:[e("thead",{children:t("tr",{children:[e("th",{children:"Contract"}),e("th",{children:"Issued"}),e("th",{children:"Due"}),e("th",{children:"Paid"}),e("th",{children:"Late Fee"}),e("th",{children:"Total"})]})}),e("tbody",{children:u.map((r,c)=>{var p=new Date(r.date_paid)>new Date(r.date_due);return t("tr",{children:[e("td",{children:r.contract_name}),e("td",{children:new Date(r.date_issued).toLocaleDateString()}),e("td",{children:new Date(r.date_due).toLocaleDateString()}),e("td",{style:p?{color:"red"}:{color:"green"},children:new Date(r.date_paid).toLocaleDateString()}),t("td",{children:["$",p?r.late_fee:0]}),t("td",{children:["$",r.total_paid]})]},c)})})]})})})]})]})]})}export{Q as default};
